<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Registrations | TeamSK's Event</title>
    <meta name="robots" content="noindex, nofollow">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Playfair+Display:wght@600;700;800&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>

<body style="background: var(--color-off-white); min-height: 100vh;">
    <div class="admin-container">
        <div class="admin-header">
            <div>
                <a href="index.html">
                    <img src="logo.png" alt="TeamSK's" class="logo-image">
                </a>
                <h1>Registration Dashboard</h1>
            </div>
            <a href="index.html" class="btn btn-secondary">‚Üê Back to Event Page</a>
        </div>

        <div class="admin-stats" id="adminStats">
            <div class="admin-stat-card">
                <span class="stat-number" id="totalRegistrations">0</span>
                <span class="stat-label">Total Registrations</span>
            </div>
            <div class="admin-stat-card">
                <span class="stat-number" id="totalRevenue">‚Çπ0</span>
                <span class="stat-label">Total Revenue</span>
            </div>
            <div class="admin-stat-card">
                <span class="stat-number" id="paidCount">0</span>
                <span class="stat-label">Paid Registrations</span>
            </div>
        </div>

        <div class="admin-actions">
            <button class="btn btn-primary" onclick="exportToCSV()">
                üì• Export to CSV
            </button>
            <button class="btn btn-export" onclick="clearAllData()">
                üóëÔ∏è Clear All Data
            </button>
            <button class="btn btn-secondary" onclick="loadRegistrations()">
                üîÑ Refresh
            </button>
        </div>

        <div class="admin-table-container">
            <table class="admin-table" id="registrationsTable">
                <thead>
                    <tr>
                        <th data-sort="registeredAt" class="sorted">
                            Date <span class="sort-icon">‚Üì</span>
                        </th>
                        <th data-sort="fullName">
                            Name <span class="sort-icon">‚Üï</span>
                        </th>
                        <th data-sort="email">
                            Email <span class="sort-icon">‚Üï</span>
                        </th>
                        <th data-sort="phone">
                            Phone <span class="sort-icon">‚Üï</span>
                        </th>
                        <th data-sort="organization">
                            Organization <span class="sort-icon">‚Üï</span>
                        </th>
                        <th data-sort="designation">
                            Designation <span class="sort-icon">‚Üï</span>
                        </th>
                        <th data-sort="category">
                            Category <span class="sort-icon">‚Üï</span>
                        </th>
                        <th data-sort="paymentStatus">
                            Payment <span class="sort-icon">‚Üï</span>
                        </th>
                        <th data-sort="paymentId">
                            Payment ID <span class="sort-icon">‚Üï</span>
                        </th>
                    </tr>
                </thead>
                <tbody id="registrationsBody">
                </tbody>
            </table>

            <div class="empty-state" id="emptyState" style="display: none;">
                <div class="empty-state-icon">üìã</div>
                <h3>No Registrations Yet</h3>
                <p>Registrations will appear here once users complete the payment process.</p>
            </div>
        </div>
    </div>

    <script>
        // Current sort state
        let currentSort = { field: 'registeredAt', ascending: false };

        // Load registrations on page load
        document.addEventListener('DOMContentLoaded', loadRegistrations);

        // Add click handlers to sortable headers
        document.querySelectorAll('.admin-table th[data-sort]').forEach(th => {
            th.addEventListener('click', function () {
                const field = this.dataset.sort;

                // Toggle direction if same field
                if (currentSort.field === field) {
                    currentSort.ascending = !currentSort.ascending;
                } else {
                    currentSort.field = field;
                    currentSort.ascending = true;
                }

                // Update UI
                document.querySelectorAll('.admin-table th').forEach(header => {
                    header.classList.remove('sorted');
                    header.querySelector('.sort-icon').textContent = '‚Üï';
                });
                this.classList.add('sorted');
                this.querySelector('.sort-icon').textContent = currentSort.ascending ? '‚Üë' : '‚Üì';

                loadRegistrations();
            });
        });

        function getRegistrations() {
            const stored = localStorage.getItem('teamsk_registrations');
            return stored ? JSON.parse(stored) : [];
        }

        function sortRegistrations(registrations, sortBy, ascending) {
            return registrations.sort((a, b) => {
                let valueA = a[sortBy] || '';
                let valueB = b[sortBy] || '';

                if (typeof valueA === 'string') {
                    valueA = valueA.toLowerCase();
                    valueB = valueB.toLowerCase();
                }

                if (ascending) {
                    return valueA > valueB ? 1 : -1;
                } else {
                    return valueA < valueB ? 1 : -1;
                }
            });
        }

        function loadRegistrations() {
            let registrations = getRegistrations();
            registrations = sortRegistrations(registrations, currentSort.field, currentSort.ascending);

            const tbody = document.getElementById('registrationsBody');
            const emptyState = document.getElementById('emptyState');
            const table = document.getElementById('registrationsTable');

            // Update stats
            document.getElementById('totalRegistrations').textContent = registrations.length;
            document.getElementById('paidCount').textContent = registrations.filter(r => r.paymentStatus === 'paid').length;
            const totalRevenue = registrations
                .filter(r => r.paymentStatus === 'paid')
                .reduce((sum, r) => sum + (r.amount || 0), 0);
            document.getElementById('totalRevenue').textContent = `‚Çπ${totalRevenue.toLocaleString()}`;

            if (registrations.length === 0) {
                tbody.innerHTML = '';
                emptyState.style.display = 'block';
                table.style.display = 'none';
                return;
            }

            emptyState.style.display = 'none';
            table.style.display = 'table';

            tbody.innerHTML = registrations.map(reg => `
                <tr>
                    <td>${formatDate(reg.registeredAt)}</td>
                    <td><strong>${escapeHtml(reg.fullName)}</strong></td>
                    <td>${escapeHtml(reg.email)}</td>
                    <td>${escapeHtml(reg.phone)}</td>
                    <td>${escapeHtml(reg.organization)}</td>
                    <td>${escapeHtml(reg.designation)}</td>
                    <td>${formatCategory(reg.category)}</td>
                    <td class="${reg.paymentStatus === 'paid' ? 'status-paid' : 'status-pending'}">
                        ${reg.paymentStatus === 'paid' ? '‚úì Paid' : 'Pending'}
                    </td>
                    <td style="font-size: 0.85rem; font-family: monospace;">${escapeHtml(reg.paymentId || '-')}</td>
                </tr>
            `).join('');
        }

        function formatDate(isoString) {
            if (!isoString) return '-';
            const date = new Date(isoString);
            return date.toLocaleDateString('en-IN', {
                day: '2-digit',
                month: 'short',
                year: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        function formatCategory(category) {
            const categories = {
                'business-owner': 'Business Owner',
                'hr-professional': 'HR Professional',
                'entrepreneur': 'Entrepreneur',
                'startup-founder': 'Start-up Founder',
                'other': 'Other'
            };
            return categories[category] || category;
        }

        function escapeHtml(str) {
            if (!str) return '';
            const div = document.createElement('div');
            div.textContent = str;
            return div.innerHTML;
        }

        function exportToCSV() {
            const registrations = getRegistrations();
            if (registrations.length === 0) {
                alert('No registrations to export.');
                return;
            }

            const headers = ['Date', 'Name', 'Email', 'Phone', 'Organization', 'Designation', 'Category', 'Payment Status', 'Payment ID', 'Amount', 'Expectations'];
            const rows = registrations.map(reg => [
                formatDate(reg.registeredAt),
                reg.fullName,
                reg.email,
                reg.phone,
                reg.organization,
                reg.designation,
                formatCategory(reg.category),
                reg.paymentStatus,
                reg.paymentId || '',
                reg.amount || '',
                reg.expectations || ''
            ]);

            const csvContent = [
                headers.join(','),
                ...rows.map(row => row.map(cell => `"${String(cell).replace(/"/g, '""')}"`).join(','))
            ].join('\n');

            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `teamsk_registrations_${new Date().toISOString().split('T')[0]}.csv`;
            link.click();
        }

        function clearAllData() {
            if (confirm('Are you sure you want to delete ALL registration data? This cannot be undone.')) {
                if (confirm('This is your last chance! Really delete all data?')) {
                    localStorage.removeItem('teamsk_registrations');
                    loadRegistrations();
                    alert('All registration data has been cleared.');
                }
            }
        }
    </script>
</body>

</html>